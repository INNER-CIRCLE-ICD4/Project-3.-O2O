# 결제 서버 API (Payment API Server)
- 본 프로젝트는 사용자에게 안정적인 결제 경험을 제공하기 위한 API 서버입니다. 신용카드 결제, 결제 조회 및 취소 등의 핵심 기능을 제공합니다.



## 1. 📜 주요 기능 요구사항
✅ 결제 요청 및 승인: 사용자는 상품 정보와 결제 수단을 기반으로 결제를 요청할 수 있습니다.

💳 다양한 결제 수단 지원: 신용카드, 계좌이체 등 기본적인 결제 수단을 처리할 수 있어야 합니다. (향후 확장 가능)

📜 결제 내역 조회: 사용자는 자신의 결제 내역을 조회할 수 있습니다.

❌ 결제 취소: 사용자는 특정 결제를 취소할 수 있으며, 취소된 결제는 상태가 명확히 변경되어야 합니다.

🔐 보안: 결제 정보는 안전하게 암호화되어야 하며, 모든 API 요청은 인증된 사용자만 가능해야 합니다.

⚙️ 오류 처리: 잘못된 요청이나 서버 문제 발생 시, 명확한 에러 코드와 메시지를 반환해야 합니다.




## 2. ⚙ 시스템 구성

- **Framework**: Spring Boot 3.x
- **Database**: PostgreSQL
- **ORM**: Spring Data JPA
- **Build**: Gradle
- **Auth**: JWT 기반 사용자 인증 연동 (Gateway 통과 후 `user-client`서비스에서 어노테이션 기반 주입)
- **Message Queue*: Kafka를 통한 결제 완료 알림 이벤트 발행
- **PG 연동**: 외부 PG사 REST API 연동 (`pgTransactionId` 기준)



## 3. 💳 API 엔드포인트 명세
API 요청 시 Authorization 헤더에 Bearer {TOKEN} 형식으로 인증 토큰을 포함해야 합니다.

| 기능              | Method | 엔드포인트                                  |
|-----------------|--------|----------------------------------------------|
| 결제 요청 생성        | POST   | /api/v1/payments                            | 
| 결제 검증 및 완료      | POST   | /api/v1/payments/complete                   | 
| 단일 결제 내역 조회     | GET    | /api/v1/payments/{paymentId}               |
| 사용자 결제 내역 조회    | GET    | /api/v1/payments/me                         |
| 결제 취소           | POST   | /api/v1/payments/{paymentId}/cancel         |


## 4. ❌ 주요 에러 코드 
| Code|       Status            |	의미| 	설명                                                  |
|---------|-----------------------|---|------------------------------------------------------|
| 400         | Bad Request           | 	잘못된 요청       |	필수 파라미터가 누락되었거나 형식이 올바르지 않습니다.|
| 401         | Unauthorized          | 	인증 실패	|유효한 인증 토큰이 없거나 만료되었습니다.                       |
| 402         | Payment Required      | 	결제 실패	|잔액 부족, 한도 초과 등 외부 결제 시스템(PG)에서 결제가 거부되었습니다.   |
| 404         | Not Found	            | 리소스 없음	|존재하지 않는 결제 정보(paymentId)를 조회 또는 수정하려고 시도했습니다. |
| 409         | Conflict	             | 충돌	|이미 취소되었거나 환불된 결제에 대해 다시 취소를 요청했습니다.               |
| 500         | Internal Server Error | 	서버 내부 오류	|서버 로직 처리 중 예상치 못한 에러가 발생했습니다.              |
